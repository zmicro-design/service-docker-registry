#!/bin/bash

load inquirer

check() {
  config::load_file $SERVICE_CONFIG

  if [ -z "$SERVICE_DOCKER_REGISTRY_DOMAIN" ]; then
    inquirer::text "请输入 SERVICE_DOCKER_REGISTRY_DOMAIN:" value
    config::set SERVICE_DOCKER_REGISTRY_DOMAIN $value $SERVICE_CONFIG
  fi

  if [ -z "$SERVICE_DOCKER_REGISTRY_DOREAMON_CLIENT_ID" ]; then
    inquirer::text "请输入 SERVICE_DOCKER_REGISTRY_DOREAMON_CLIENT_ID:" value
    config::set SERVICE_DOCKER_REGISTRY_DOREAMON_CLIENT_ID $value $SERVICE_CONFIG
  fi

  if [ -z "$SERVICE_DOCKER_REGISTRY_DOREAMON_CLIENT_SECRET" ]; then
    inquirer::text "请输入 SERVICE_DOCKER_REGISTRY_DOREAMON_CLIENT_SECRET:" value
    config::set SERVICE_DOCKER_REGISTRY_DOREAMON_CLIENT_SECRET $value $SERVICE_CONFIG
  fi

  if [ -z "$SERVICE_DOCKER_REGISTRY_DOREAMON_ALLOW_USERNAMES" ]; then
    inquirer::text "请输入 SERVICE_DOCKER_REGISTRY_DOREAMON_ALLOW_USERNAMES:" value
    config::set SERVICE_DOCKER_REGISTRY_DOREAMON_ALLOW_USERNAMES $value $SERVICE_CONFIG
  fi

  if [ -z "$SERVICE_DOCKER_REGISTRY_ADMIN_USERNAME" ]; then
    inquirer::text "请输入 SERVICE_DOCKER_REGISTRY_ADMIN_USERNAME:" value
    config::set SERVICE_DOCKER_REGISTRY_ADMIN_USERNAME $value $SERVICE_CONFIG
  fi

  if [ -z "$SERVICE_DOCKER_REGISTRY_ADMIN_PASSWORD" ]; then
    inquirer::text "请输入 SERVICE_DOCKER_REGISTRY_ADMIN_PASSWORD:" value
    config::set SERVICE_DOCKER_REGISTRY_ADMIN_PASSWORD $value $SERVICE_CONFIG
  fi

  if [ -z "$SERVICE_DOCKER_REGISTRY_ALY_OSS_ACCESS_KEY" ]; then
    inquirer::text "请输入 SERVICE_DOCKER_REGISTRY_ALY_OSS_ACCESS_KEY:" value
    config::set SERVICE_DOCKER_REGISTRY_ALY_OSS_ACCESS_KEY $value $SERVICE_CONFIG
  fi

  if [ -z "$SERVICE_DOCKER_REGISTRY_ALY_OSS_ACCESS_SECRET" ]; then
    inquirer::text "请输入 SERVICE_DOCKER_REGISTRY_ALY_OSS_ACCESS_SECRET:" value
    config::set SERVICE_DOCKER_REGISTRY_ALY_OSS_ACCESS_SECRET $value $SERVICE_CONFIG
  fi

  if [ -z "$SERVICE_DOCKER_REGISTRY_ALY_OSS_REGION" ]; then
    inquirer::text "请输入 SERVICE_DOCKER_REGISTRY_ALY_OSS_REGION:" value
    config::set SERVICE_DOCKER_REGISTRY_ALY_OSS_REGION $value $SERVICE_CONFIG
  fi

  if [ -z "$SERVICE_DOCKER_REGISTRY_ALY_OSS_BUCKET" ]; then
    inquirer::text "请输入 SERVICE_DOCKER_REGISTRY_ALY_OSS_BUCKET:" value
    config::set SERVICE_DOCKER_REGISTRY_ALY_OSS_BUCKET $value $SERVICE_CONFIG
  fi
  
  # @TODO load again
  config::load_file $SERVICE_CONFIG

  # @TODO
  export SERVICE_DOCKER_REGISTRY_DOMAIN=$SERVICE_DOCKER_REGISTRY_DOMAIN
  export SERVICE_DOCKER_REGISTRY_DOREAMON_CLIENT_ID=$SERVICE_DOCKER_REGISTRY_DOREAMON_CLIENT_ID
  export SERVICE_DOCKER_REGISTRY_DOREAMON_CLIENT_SECRET=$SERVICE_DOCKER_REGISTRY_DOREAMON_CLIENT_SECRET
  export SERVICE_DOCKER_REGISTRY_DOREAMON_ALLOW_USERNAMES=$SERVICE_DOCKER_REGISTRY_DOREAMON_ALLOW_USERNAMES

  export SERVICE_DOCKER_REGISTRY_ADMIN_USERNAME=$SERVICE_DOCKER_REGISTRY_ADMIN_USERNAME
  export SERVICE_DOCKER_REGISTRY_ADMIN_PASSWORD=$SERVICE_DOCKER_REGISTRY_ADMIN_PASSWORD

  export SERVICE_DOCKER_REGISTRY_ALY_OSS_ACCESS_KEY=$SERVICE_DOCKER_REGISTRY_ALY_OSS_ACCESS_KEY
  export SERVICE_DOCKER_REGISTRY_ALY_OSS_ACCESS_SECRET=$SERVICE_DOCKER_REGISTRY_ALY_OSS_ACCESS_SECRET
  export SERVICE_DOCKER_REGISTRY_ALY_OSS_REGION=$SERVICE_DOCKER_REGISTRY_ALY_OSS_REGION
  export SERVICE_DOCKER_REGISTRY_ALY_OSS_BUCKET=$SERVICE_DOCKER_REGISTRY_ALY_OSS_BUCKET

}

check $@
